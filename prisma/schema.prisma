generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  relationMode      = "prisma"
}

model User {
  address      String      @unique
  swapTxs      Swap[]
  liquidityTxs Liquidity[]
}

model Token {
  address       String @id
  name          String
  symbol        String
  decimals      Int
  poolsAsToken0 Pool[] @relation("pool0")
  poolsAsToken1 Pool[] @relation("pool1")
}

model Pool {
  address       String      @id
  binStep       Int
  token0Address String
  token1Address String
  token0        Token       @relation("pool0", fields: [token0Address], references: [address])
  token1        Token       @relation("pool1", fields: [token1Address], references: [address])
  analytics     Analytics[]
  swapTxs       Swap[]
  liquidityTxs  Liquidity[]
}

model Analytics {
  date         DateTime
  volume       Int
  fees         Int
  token0Locked BigInt
  token1Locked BigInt
  usdLocked    Int
  close        Float
  high         Float
  low          Float
  open         Float
  poolAddress  String
  pool         Pool     @relation(fields: [poolAddress], references: [address])

  @@id([poolAddress, date])
}

model Swap {
  poolAddress String
  swapForY    Boolean
  binId       Int
  amountIn    BigInt
  amountOut   BigInt
  timestamp   DateTime
  txHash      String
  indexInSlot Int      @default(1)
  usdValue    Float
  userAddress String
  pool        Pool     @relation(fields: [poolAddress], references: [address])
  user        User     @relation(fields: [userAddress], references: [address])

  @@id([txHash, indexInSlot])
}

model Liquidity {
  poolAddress String
  amount0     BigInt
  amount1     BigInt
  timestamp   DateTime
  txHash      String
  indexInSlot Int      @default(1)
  lowerBound  Int
  upperBound  Int
  usdValue    Float
  userAddress String
  pool        Pool     @relation(fields: [poolAddress], references: [address])
  user        User     @relation(fields: [userAddress], references: [address])

  @@id([txHash, indexInSlot])
}
